@using X.PagedList.Mvc.Core; @*import this so we get our HTML Helper*@
@using X.PagedList; @*import this so we can cast our list to IPagedList (only necessary because ViewBag is dynamic)*@
@using X.PagedList.Mvc.Core.Fluent
@using X.PagedList.Web.Common
@model IEnumerable<FYP.Models.Dashboard.Answer>
@inject FYP.Models.Dashboard.Discussion dicus
@{
    Layout = "_Layout";
    ViewData["Title"] = "Discussion";
    var pagedList = (IPagedList)ViewBag.answer;
    var Qid = ViewBag.Qid;
    var q = ViewBag.question;
    var sub_T = ViewBag.subTitle;
    var Title = ViewBag.title;
    var asked_By = ViewBag.askedby;
    var date = ViewBag.date;
    var currentUser = ViewBag.currentUser;
    var Answered_By = TempData["Ansby"];
    bool hasAnswered = false;

    foreach (var user in Model)
    {
        if (user.Answered_By == currentUser)
        {
            hasAnswered = true;
        }
    }
}

<body style="" class="links-background">

</body>

@if (TempData["AAdded"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert" style="z-index:1">
        <strong>Answer Was Delivered Successfully ||</strong> A new Answer has been submitted by <strong class="text-success">@Answered_By</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["ADeleted"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert" style="z-index:1">
        <strong>Answer deleted Successfully ||</strong> An Answer was deleted.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
<div class="row">
    <div class="col-8 bg-black bg-opacity-75 signin-pageContent p-4 rounded" style="height:85vh;">
        <center>
            <h1 class="text-white fw-bold bg-white bg-opacity-10 text-white rounded">Answers</h1>
            <p>Answer the question.</p>
        </center>
        <center>

            @Html.PagedListPager(pagedList,
            page => Url.Action("SeeAnswer","Dashboard",
            new { page }),
            new PagedListRenderOptions()
            {
            DisplayItemSliceAndTotal = true,
            ItemSliceAndTotalPosition = ItemSliceAndTotalPosition.End,
            MaximumPageNumbersToDisplay=3
            })

        </center>
        @if (Model?.Any() == false)
        {
            <div class="card bg-black text-white">
                <div class="card-header bg-black bg-opacity-50 text-white">
                    <center><label class="text-white fw-bold text-uppercase"> Asked By : <label class="text-success">@asked_By</label> on <label class="text-info">@date </label></label></center>
                </div>
                <hr>
                <div class="card-body bg-black bg-opacity-50 text-white">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item bg-info bg-opacity-10 text-white">
                            <label class="text-success">Title : </label> @Title
                        </li>
                        <li class="list-group-item bg-success bg-opacity-10 text-white">
                            <label class="text-warning">SubTitle : </label> @sub_T
                        </li>
                        <li class="list-group-item bg-warning bg-opacity-10 text-white">
                            <label class="text-info">Question :</label> @q
                        </li>
                    </ul>
                </div>
                <hr>
                <div class="card-footer bg-body bg-opacity-50 text-white">
                    <center><label class="text-white fw-bold text-uppercase"> No Answer Yet. </label></center>
                </div>
            </div>
            <div class="text-center mt-2">
                <a asp-action="Discussion" asp-controller="Dashboard" class="btn btn-outline-success col-3 mx-1">All Questions</a>

                <a asp-action="AnswerTheQuestion" asp-controller="Dashboard" asp-route-Qid="@Qid" class="btn btn-outline-info col-3 mx-1">Answer This Question</a>
            </div>

        }
        else
        {
            <div class="overflow-scroll p-3" style="height:58vh;">
                <div class="card bg-black text-white">
                    <div class="card-header bg-black bg-opacity-50 text-white">
                        <center><label class="text-white fw-bold text-uppercase"> Asked By : <label class="text-success">@asked_By</label> on <label class="text-info">@date </label></label></center>
                    </div>
                    <hr>
                    <div class="card-body bg-black bg-opacity-50 text-white">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item bg-info bg-opacity-10 text-white">
                                <label class="text-success">Title : </label> @Title
                            </li>
                            <li class="list-group-item bg-success bg-opacity-10 text-white">
                                <label class="text-warning">SubTitle : </label> @sub_T
                            </li>
                            <li class="list-group-item bg-warning bg-opacity-10 text-white">
                                <label class="text-info">Question :</label> @q
                            </li>
                        </ul>
                    </div>
                    <div class="text-center mt-2">
                        <a asp-action="Discussion" asp-controller="Dashboard" class="btn btn-outline-success col-3 mx-1">All Questions</a>
                        @if (!hasAnswered)
                        {
                        <a asp-action="AnswerTheQuestion" asp-controller="Dashboard" asp-route-Qid="@Qid" class="btn btn-outline-info col-3 mx-1">Answer This Question</a>
                        }
                    </div>
                    <hr>
                </div>
                @foreach (var item in Model)
                {
                    var Accorid = item.Answered_By + "acordion";

                    <div class="accordion accordion-flush" id="@Accorid">

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@item.Answered_By" aria-expanded="false" aria-controls="@item.Answered_By">
                                    @if (item.Answered_By == currentUser)
                                    {
                                        <b class="text-success">Answered by : @item.Answered_By (You)</b>
                                    }
                                    else
                                    {
                                        <b class="text-success">Answered by : @item.Answered_By</b>
                                    }
                                </button>
                            </h2>
                            <div id="@item.Answered_By" class="accordion-collapse collapse" data-bs-parent="#@Accorid">
                                <div class="accordion-body">
                                    <div class="col-lg-4 d-flex">
                                        <label asp-for="@item._Answer" class="text-success fw-bold d-block mx-2 text-uppercase"></label> :
                                        <label class="text-black"> @Html.DisplayFor(x=>@item._Answer) </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-2">
                            @if (item.Answered_By == currentUser)
                            {
                               
                                <a href="#_Delete" data-bs-toggle="modal" data-bs-target="#_Delete" class="btn btn-outline-danger m-1">Delete</a>
                                <a asp-action="EditAnswer" asp-controller="Dashboard" asp-route-id="@item.id" class="btn btn-outline-info col-3 mx-1">Edit Answer</a>

                            }
                           
                        </div>
                    </div>                    


                    <!-- Modal -->
                    <div class="modal fade" id="_Delete" tabindex="-1" aria-labelledby="Delete" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content text-white bg-black bg-opacity-50">
                                <div class="modal-header text-center">
                                    <h1 class="modal-title fs-5 fw-bold text-uppercase" id="DeleteEvent">Do you want to delete this Answer?</h1>
                                    <button type="button" class="btn-close filt " data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form asp-controller="Dashboard" asp-action="DeleteAnswer" asp-route-id="@item.id" asp-route-Qid="@Qid">
                                    <input type="hidden" asp-for="@item.id" />
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                        <button type="submit" class="btn btn-primary">Yes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <hr />
                }
            </div>
        }

    </div>
</div>

<style>
    .modal-backdrop {
        display: none;
    }

</style>

